<script language="JavaScript">
<!-- BEGIN script hiding
function isblank(s)
{
    for (var i = 0; i < s.length; i++) {
        var c = s.charAt(i);
	if ((c != ' ') && (c != '\n') && (c != '\t')) return false;
    }
    return true;
}

function verify(f)
{
    var msg;
    var errors = "";

    if (f.seq_input_method[0].checked) {
    	if (f.seq_list.value == null || f.seq_list.value == "" || isblank(f.seq_list.value)) {
	    	errors += "No sequences were pasted into the Paste Sequences box\n";
		}
    } else if (f.seq_input_method[1].checked) {
    	if (f.seq_file.value == null || f.seq_file.value == "" || isblank(f.seq_file.value)) {
	    	errors += "No sequence upload file was selected\n";
		}
    }

	if (f.tf_select_method[0].checked) {
    	if (!f.tax_group[0].checked && !f.tax_group[1].checked && !f.tax_group[2].checked && !f.tax_group[3].checked && !f.tax_group[4].checked) {
	    	errors += "No taxonomic supergroups were selected\n";
		}
    } else if (f.tf_select_method[1].checked) {
    	var tfs_selected = false;
    	for (var i = 0; i < f.tfs.options.length; i++) {
	    	if (f.tfs.options[i].selected) {
	    		tfs_selected = true;
				break;
	   		}
		}
		if (!tfs_selected) {
	 	   errors += "No specific profiles were selected\n";
		}
    }

    var v = parseFloat(f.threshold.value);
    if (isNaN(v)) {
		errors += "Matrix match threshold is not a valid number\n";
    } else {
		if (v < [%min_threshold%]) {
	 	   errors += "Matrix match threshold is below minimum allowable";
	 	   errors += " value of [%min_threshold%]%\n";
		}
    }
	
	if (f.email.value == null || f.email.value == "" || isblank(f.email.value)) {
	    	errors += "No email was provided\n";
	}
		
    if (!errors) return true;

    msg = "_________________________________________________________\n\n";
    msg += "The analysis was not submitted due to the following problem(s).\n";
    msg += "Please correct these problem(s) and re-submit.\n";
    msg += "________________________________________________________\n\n";
    msg += errors;
    alert(msg);
    return false;
}
// END script hiding -->
</script>

<form name="input" enctype="multipart/form-data" method="post" onSubmit="return verify(this)">
  <h2>Select Analysis Parameters</h2>
  <h3>STEP 1a: Enter your sequences</h3>
  <p>
    <input type="radio" name="seq_input_method" value="paste" checked>
    <span class="text">Paste sequences (fasta format):</span><br>
<!--
    <input type="button" name="use_sample_seqs" value="Use sample seqs"
      onClick="{input.seq_input_method[0].checked=true; input.seq_list.value="[%sample_sequences%]}">
-->
    <textarea name="seq_list" rows=5 cols=50 wrap=SOFT
      onFocus="{input.seq_input_method[0].checked=true}" 
      onChange="{
      if (!isblank(input.seq_list.value))
        {input.seq_input_method[0].checked=true}
      else if (!isblank(input.seq_file.value))
        {input.seq_input_method[1].checked=true}}"></textarea>
    <br>
    <input type="button" name="clear_seqs" value="Clear"
      onClick="{input.seq_list.value=''}">
    <br><br>
    <input type="radio" name="seq_input_method" value="upload">
    <span class="text"><b>OR</b> upload a file containing a list of sequences (fasta format):</span><br>
    <span class="subtext">
    <input type="file" name="seq_file" size="40"
      onClick="{input.seq_input_method[1].checked=true}"
      onFocus="{input.seq_input_method[1].checked=true}"
      onChange="{
        if (!isblank(input.seq_file.value))
	  {input.seq_input_method[1].checked=true}}
	else if (!isblank(input.seq_list.value))
	  {input.seq_input_method[0].checked=true}}">
    </span>
    <br><br>
  </p>
  <h3>STEP 1b: Enter a background list of sequences</h3>
  <p>
    <input type="radio" name="bg_seq_input_method" value="default" checked>
    <span class="text">Choose a background (sequences randomly selected from experimental control peaks)</span>
    <select name="bg_seq_set_key" onChange="{input.bg_seq_input_method[0].checked=true}">
      [%FOREACH key = bg_seq_set_keys%]
        <option value="[%key%]">[%bg_seq_set_names.$key%]</option>
      [%END%]
    </select>
    <br>
    <input type="radio" name="bg_seq_input_method" value="paste">
    <span class="text"><b>OR</b> Paste background sequences:</span><br>
    <textarea name="bg_seq_list" rows=5 cols=50 wrap=SOFT
      onFocus="{input.bg_seq_input_method[1].checked=true}" 
      onChange="{
        if (!isblank(input.bg_seq_list.value))
          {input.bg_seq_input_method[1].checked=true}
        else if (!isblank(input.bg_seq_file.value))
          {input.bg_seq_input_method[2].checked=true}
        else {input.bg_seq_input_method[0].checked=true}}"></textarea>
    <br>
    <input type="button" name="clear_bg_seqs" value="Clear"
      onClick="{input.bg_seq_list.value=''}">
    <br><br>
    <input type="radio" name="bg_seq_input_method" value="upload">
    <span class="text"><b>OR</b> upload a file containing a list of background sequences:</span><br>
    <span class="subtext">
    <input type="file" name="bg_seq_file" size="40"
      onClick="{input.bg_seq_input_method[2].checked=true}"
      onFocus="{input.bg_seq_input_method[2].checked=true}"
      onChange="{
        if (!isblank(input.bg_seq_file.value))
	  {input.bg_seq_input_method[2].checked=true}
	else if (!isblank(input.bg_seq_list.value))
	  {input.bg_seq_input_method[1].checked=true}
	else {input.bg_seq_input_method[0].checked=true}}">
    </span>
  </p>
  <hr noshade><br>
  <h3>STEP 2: Select transcription factor binding site matrices</h3> 

  <h4>JASPAR CORE Profiles</h4>
  <p> 
    <input type="radio" name="tf_select_method" value="tax_group" checked>
    <span class="text">Select by taxonomic supergroup:</span><br> 
    <span class="subtext">
    [%FOREACH tax_group = tax_groups%]
      <input type="checkbox" name="tax_group" value=[%tax_group%]
        onClick="{if (checked) {input.tf_select_method[0].checked=true}}">[%tax_group%]&nbsp;
    [%END%]
    </span>
    <br>
    <span class="text">&nbsp;&nbsp;and limit profiles to those with a minimum information content (specificity) of <input type="text" name="core_min_ic" value=[%in_min_ic%] size="2" onFocus="{input.tf_select_method[0].checked=true}"> bits</span>
    <br><br>
    <input type="radio" name="tf_select_method" value="specific">
    <span class="text"><b>OR</b> select specific profiles:</span><br>
    <select multiple size=8 name=tfs
      onFocus="{input.tf_select_method[1].checked=true}">
      [%FOREACH tf = core_tfs%]
        <option value=[%tf.ID()%]>[%tf.name()%]</option>
      [%END%]
    </select>
  </p>

  <h4>JASPAR Collections</h4>
  <p>
  [%FOREACH collection = collections%]
    <input type="radio" name="tf_select_method" value=[%collection%]>
    <span class="text">All [%collection%] profiles</span>
    <br>
  [%END%]
  </p>


  <h4>Custom Profiles</h4>
  <p>
    <input type="radio" name="tf_select_method" value="paste">
    <span class="text">paste one or more TFBS profiles</span><br>
    <textarea name="matrix_paste_text" rows=5 cols=50 wrap=SOFT
      onFocus="{input.tf_select_method[7].checked=true}"
      onChange="{
        if (!isblank(input.matrix_paste_text.value))
          {input.tf_select_method[7].checked=true}
        else if (!isblank(input.matrix_paste_text.value))
          {input.tf_select_method[7].checked=true}
      }"</textarea>
    <br>
    <input type="button" name="clear_profiles" value="Clear"
      onClick="{input.matrix_paste_text.value=''}">
    <br><br>

    <input type="radio" name="tf_select_method" value="upload">
    <span class="text">upload a file containing one or more TFBS profiles</span>
    <br>
    <span class="subtext">
    <input type="file" name="matrix_upload_file" size="40"
      onClick="{input.tf_select_method[8].checked=true}"
      onFocus="{input.tf_select_method[8].checked=true}"
      onChange="{
        if (!isblank(input.matrix_upload_file.value))
          {input.tf_select_method[8].checked=true}
        else if (!isblank(input.matrix_upload_file.value))
          {input.tf_select_method[8].checked=true}
      }">
    </span>
  </p>
      
  <hr noshade><br>
  <h3>STEP 3: Select parameters</h3>
  <p>
    <span class="text">Matrix match threshold (min. [%min_threshold%]%):<br>
    <input type="text" name="threshold" value=[%dflt_threshold%] size="4">%
    </span>
    <br><br>
    <span class="text">Number of results to display:
    <br>
    <input type="radio" name="result_type" value="top_x_results" checked> Top
    <select name="num_results">
      <option value="5">5</option>
      <option value="10">10</option>
      <option value="20">20</option>
      <option value="All" selected>All</option>
    </select> results
    <br>
    <input type="radio" name="result_type" value="significant_hits"> <b>OR</b> only results with <b>Z-score >= </b>
    <select name="zscore_cutoff">
      <option value="5">5</option>
      <option value="10" selected>10</option>
      <option value="15">15</option>
    </select>
    and <b>Fisher score <= </b>
    <select name="fisher_cutoff">
      <option value="0.05">0.05</option>
      <option value="0.01" selected>0.01</option>
      <option value="0.001">0.001</option>
    </select>
    (Default values have been chosen based on empirical studies)
    <br>
    <br>
    <span class="text">Sort results by:
    <br>
    <input type="radio" name="result_sort_by" value="zscore" checked>Z-score
    <input type="radio" name="result_sort_by" value="fisher">Fisher score
    </span>
    <br><br>
  </p>
  <p class="text"> 
    <span class="text">Enter your email address:
    <input type="text" name="email" value="">
    </span><br><br>
    Press the <b>Submit</b> button to perform the analysis or <b>Reset</b> to reset the analysis parameters to their default values.<br>The results will be sent to the email address you provided.<br>
    <br><br>
    <input type="submit" name="Submit" value="Submit">
    <input type="reset" name="Reset" value="Reset">
    <input type="hidden" name="rm" value="process">
    <br>
  </p>
</form>
